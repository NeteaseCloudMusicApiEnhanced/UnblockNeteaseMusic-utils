<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>UnblockNeteaseMusic Utils</title>
  <style>
    :root {
      --fg: #333;
      --muted: #666;
      --border: #ddd;
      --bg: #f5f5f5;
      --panel: #ffffff;
      --accent: #c20c0c;
      --accent-hover: #a00808;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: var(--fg); background: var(--bg); line-height: 1.6; }
    .container { max-width: 960px; margin: 40px auto; padding: 0 20px; }
    header.site-header { margin-bottom: 24px; }
    header.site-header h1 { font-size: 28px; font-weight: 600; margin: 0; }
    .badge { display: inline-block; margin-left: 8px; padding: 4px 10px; border: 1px solid var(--border); border-radius: 12px; font-size: 12px; color: var(--muted); }
    .badge.version { background: #e8f5e9; border-color: #c8e6c9; color: #2e7d32; }
    .sub { margin-top: 8px; color: var(--muted); font-size: 14px; }
    .block { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
    .block h2 { margin: 0 0 12px; font-size: 18px; font-weight: 600; }
    .kvs { display: grid; grid-template-columns: 140px 1fr; gap: 8px 16px; align-items: center; }
    .kvs div:first-child { color: var(--muted); }
    ul.links { list-style: none; padding: 0; margin: 0; }
    ul.links li { margin: 8px 0; }
    ul.links a { color: var(--fg); text-decoration: none; border-bottom: 1px dotted var(--border); transition: all 0.2s ease; }
    ul.links a:hover { color: var(--accent); border-bottom-color: var(--accent); }
    pre { margin: 0; background: #f9f9f9; border: 1px solid var(--border); border-radius: 6px; padding: 12px; overflow: auto; }
    code { font-family: 'Courier New', monospace; font-size: 13px; }
    .source-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; background: #e3f2fd; color: #1565c0; margin-right: 6px; }
    footer.site-footer { margin-top: 24px; padding-top: 12px; border-top: 1px solid var(--border); color: var(--muted); text-align: center; }
    footer.site-footer a { color: var(--fg); text-decoration: none; transition: color 0.2s ease; }
    footer.site-footer a:hover { color: var(--accent); }
    .test-form { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .test-form input[type="text"] { flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; }
    .test-form select { padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; background: white; }
    .test-form button { padding: 8px 20px; background: var(--accent); color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; transition: background 0.2s ease; }
    .test-form button:hover { background: var(--accent-hover); }
    .test-result { margin-top: 12px; padding: 12px; background: #f5f5f5; border-radius: 6px; font-size: 13px; }
    .test-result .url { word-break: break-all; color: var(--accent); margin-bottom: 8px; }
    .test-result .source { color: var(--muted); font-size: 12px; margin-bottom: 8px; }
    .test-result audio { width: 100%; margin-top: 8px; }
    .test-result .copy-btn { display: inline-block; padding: 4px 12px; background: var(--fg); color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s ease; margin-top: 8px; }
    .test-result .copy-btn:hover { background: var(--accent); }
  </style>
</head>
<body>
  <main class="container">
    <header class="site-header">
      <h1>UnblockNeteaseMusic Utils <span id="version" class="badge version"></span></h1>
      <p class="sub">âš™ï¸ ç½‘æ˜“äº‘éŸ³ä¹è§£ç°å·¥å…· || åŸºäº Express.js çš„ RESTful API æœåŠ¡ || è‡ªåŠ¨å°è¯•å¤šä¸ªéŸ³æºç›´åˆ°æ‰¾åˆ°å¯ç”¨é“¾æ¥</p>
    </header>

    <section class="block">
      <h2>æœåŠ¡å™¨çŠ¶æ€</h2>
      <div class="kvs">
        <div>Base URL</div><div id="base-url">â€”</div>
        <div>å½“å‰é¡µ</div><div id="current-url">â€”</div>
      </div>
    </section>

    <section class="block">
      <h2>åœ¨çº¿æµ‹è¯•</h2>
      <p>è¾“å…¥ç½‘æ˜“äº‘éŸ³ä¹æ­Œæ›² ID è¿›è¡Œæµ‹è¯•ï¼š</p>
      <div class="test-form">
        <input type="text" id="song-id" placeholder="æ­Œæ›² IDï¼Œå¦‚ï¼š2756058128" />
        <select id="source-select">
          <option value="">è‡ªåŠ¨é€‰æ‹©éŸ³æº</option>
        </select>
        <button onclick="testMatch()">æµ‹è¯•</button>
      </div>
      <div id="test-result" class="test-result" style="display: none;"></div>
    </section>

    <section class="block">
      <h2>API æ¥å£</h2>
      <ul class="links">
        <li><a href="/match?id=2756058128" target="_blank">GET /match - è·å–éŸ³ä¹é“¾æ¥ï¼ˆè‡ªåŠ¨éŸ³æºï¼‰</a></li>
        <li><a id="api-example-link" href="/match?id=2756058128&source=" target="_blank">GET /match?source=[æ¨¡å—å] - æŒ‡å®šéŸ³æº</a></li>
      </ul>
      <h3 style="margin: 16px 0 8px; font-size: 15px; font-weight: 600;">POST è¯·æ±‚ç¤ºä¾‹ï¼š</h3>
      <pre><code>curl -X POST {origin}/match \
  -H "Content-Type: application/json" \
  -d '{"id": "2756058128", "source": "[æ¨¡å—å]"}</code></pre>
    </section>

    <section class="block">
      <h2>å¯ç”¨éŸ³æºæ¨¡å—</h2>
      <ul class="links">
        <li><span style="color: var(--muted);">æ­£åœ¨åŠ è½½æ¨¡å—åˆ—è¡¨...</span></li>
      </ul>
      <p style="margin-top: 12px; color: var(--muted); font-size: 13px;">ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•æ‰€æœ‰å¯ç”¨æ¨¡å—ï¼Œç›´åˆ°æ‰¾åˆ°å¯ç”¨çš„éŸ³ä¹é“¾æ¥ã€‚</p>
    </section>

    <section class="block">
      <h2>ä½¿ç”¨æ–¹å¼</h2>
      <h3 style="margin: 16px 0 8px; font-size: 15px; font-weight: 600;">å‘½ä»¤è¡Œè¿è¡Œï¼š</h3>
      <pre><code># ä½¿ç”¨é»˜è®¤ç«¯å£ 3000
npx @neteasecloudmusicapienhanced/unblockmusic-utils

# æŒ‡å®šç«¯å£
npx @neteasecloudmusicapienhanced/unblockmusic-utils --port 8080

# æœ¬åœ°è¿è¡Œ
npm start</code></pre>
      <h3 style="margin: 16px 0 8px; font-size: 15px; font-weight: 600;">ä½œä¸ºæ¨¡å—ä½¿ç”¨ï¼š</h3>
      <pre><code>const { matchID } = require('@neteasecloudmusicapienhanced/unblockmusic-utils');

const result = await matchID('æ­Œæ›²ID', 'éŸ³æºæ¨¡å—åï¼ˆå¯é€‰ï¼‰');</code></pre>
    </section>

    <footer class="site-footer">
      <a href="https://github.com/NeteaseCloudMusicApiEnhanced/UnblockNeteaseMusic-utils" target="_blank">GitHub</a>
      <span style="margin: 0 8px;">Â·</span>
      <a href="https://www.npmjs.com/package/@neteasecloudmusicapienhanced/unblockmusic-utils" target="_blank">NPM</a>
    </footer>
  </main>

  <script>
    var origin = window.location.origin;

    function updateStatus() {
      document.getElementById('base-url').textContent = origin;
      document.getElementById('current-url').textContent = window.location.href;

      // ä»APIè·å–ç‰ˆæœ¬å·
      fetch('/inner/version')
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var v = data && data.data && data.data.version;
          if (v) {
            document.getElementById('version').textContent = 'v' + v;
          }
        })
        .catch(function() {
          document.getElementById('version').textContent = 'v0.1.4';
        });

      // ä»APIè·å–å¯ç”¨æ¨¡å—åˆ—è¡¨
      fetch('/inner/modules')
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var modules = data && data.data && data.data.modules;
          if (modules && modules.length > 0) {
            populateModules(modules);
          }
        })
        .catch(function() {
          console.warn('Failed to load modules list');
        });

      var pres = document.querySelectorAll('pre code');
      pres.forEach(function(pre) {
        pre.textContent = pre.textContent.replace(/\{origin\}/g, origin);
      });
    }

    function populateModules(modules) {
      // æ›´æ–°æµ‹è¯•è¡¨å•çš„ä¸‹æ‹‰é€‰æ‹©æ¡†
      var select = document.getElementById('source-select');
      var firstOption = select.querySelector('option[value=""]');
      select.innerHTML = '';
      select.appendChild(firstOption);
      modules.forEach(function(module) {
        var option = document.createElement('option');
        option.value = module;
        option.textContent = module.charAt(0).toUpperCase() + module.slice(1);
        select.appendChild(option);
      });

      // æ›´æ–°å¯ç”¨éŸ³æºæ¨¡å—åˆ—è¡¨
      var modulesList = document.querySelector('.block:nth-of-type(4) ul.links');
      if (modulesList) {
        modulesList.innerHTML = '';
        modules.forEach(function(module) {
          var li = document.createElement('li');
          li.innerHTML = '<span class="source-tag">' + module + '</span>' + module.charAt(0).toUpperCase() + module.slice(1) + ' éŸ³æºæœåŠ¡';
          modulesList.appendChild(li);
        });
      }

      // æ›´æ–°APIç¤ºä¾‹é“¾æ¥
      var apiExampleLink = document.getElementById('api-example-link');
      if (apiExampleLink && modules.length > 0) {
        var firstModule = modules[0];
        apiExampleLink.href = '/match?id=2756058128&source=' + firstModule;
        apiExampleLink.textContent = 'GET /match?source=' + firstModule + ' - æŒ‡å®š ' + firstModule.charAt(0).toUpperCase() + firstModule.slice(1) + ' éŸ³æº';
      }
    }

    function testMatch() {
      var songId = document.getElementById('song-id').value.trim();
      var source = document.getElementById('source-select').value;
      var resultDiv = document.getElementById('test-result');

      if (!songId) {
        resultDiv.innerHTML = '<span style="color: var(--accent);">è¯·è¾“å…¥æ­Œæ›² ID</span>';
        resultDiv.style.display = 'block';
        return;
      }

      resultDiv.innerHTML = '<span style="color: var(--muted);">æ­£åœ¨åŒ¹é…...</span>';
      resultDiv.style.display = 'block';

      var url = '/match?id=' + encodeURIComponent(songId);
      if (source) {
        url += '&source=' + encodeURIComponent(source);
      }

      fetch(url)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          if (data.code === 200 && data.data && data.data.url) {
            var audioUrl = data.data.url;
            var sourceName = data.data.source || 'è‡ªåŠ¨é€‰æ‹©';
            resultDiv.innerHTML = 
              '<div class="url">ğŸµ ' + audioUrl + '</div>' +
              '<div class="source">éŸ³æº: ' + sourceName + '</div>' +
              '<audio controls autoplay>' +
                '<source src="' + audioUrl + '" type="audio/mpeg">' +
                '<source src="' + audioUrl + '" type="audio/flac">' +
                'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾' +
              '</audio>' +
              '<button class="copy-btn" onclick="copyToClipboard(\'' + audioUrl + '\')">å¤åˆ¶é“¾æ¥</button>';
          } else {
            var errorMsg = data.message || 'æœªæ‰¾åˆ°å¯ç”¨çš„éŸ³ä¹é“¾æ¥';
            resultDiv.innerHTML = '<span style="color: var(--accent);">' + errorMsg + '</span>';
          }
        })
        .catch(function(err) {
          resultDiv.innerHTML = '<span style="color: var(--accent);">è¯·æ±‚å¤±è´¥: ' + err.message + '</span>';
        });
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(function() {
        alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      }).catch(function(err) {
        prompt('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š', text);
      });
    }

    document.addEventListener('DOMContentLoaded', updateStatus);
  </script>
</body>
</html>